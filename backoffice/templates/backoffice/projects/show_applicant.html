{% extends 'backoffice/base.html' %}
{% load static %}
{% block content %}
  <!-- Core CSS file -->
  <link rel="stylesheet" href="{% static 'lib/photoswipe/photoswipe.css' %}"> 

  <!-- Skin CSS file (styling of UI - buttons, caption, etc.)
      In the folder of skin CSS file there are also:
      - .png and .svg icons sprite, 
      - preloader.gif (for browsers that do not support CSS animations) -->
  <link rel="stylesheet" href="{% static 'lib/photoswipe/default-skin.css' %}"> 

  <!-- Core JS file -->
  <script src="{% static 'lib/photoswipe/photoswipe.min.js' %}"></script> 

  <!-- UI JS file -->
  <script src="{% static 'lib/photoswipe/photoswipe-ui-default.min.js' %}"></script>

  <div class="row" style="margin-top: -10px;">
    <div class="col-md-12">
      <div class="float-right border rounded p5">
        {% include 'backoffice/projects/include/applicant_nav.html' %}
      </div>
      <div>
        <b>ผู้สมัครโครงการ{{ project }} {{ admission_round}} | สาขา{{ major.title }}</b> (เรียกสัมภาษณ์แล้ว <span id="accepted_for_interview_count_id">{{ major_accepted_for_interview_count }}</span> คน)
        <br />
        {{ applicant }}
        {% if has_paid %}
          <span class="badge badge-success"><i class="fa fa-check"></i> ชำระค่าสมัครแล้ว</span>
        {% else %}
          <span class="badge badge-danger"><i class="fa fa-close"></i> ยังไม่ชำระค่าสมัคร</span>
        {% endif %}
      </div>
      {% include 'backoffice/projects/include/applicant_info.html' %}
      {% include 'backoffice/projects/include/applicant_toolbar.html' %}
    </div>
  </div>

  <div class="row">
    <div class="col-md-2"> 
      <div id="document_menu_id" style="overflow-y: auto;">
        {% include 'backoffice/projects/include/applicant_uploaded_doc_menu.html' %}
      </div>
    </div>
    <div class="col-md-7">        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="pswp__bg"></div>
        
          <div class="pswp__scroll-wrap">
        
          <div class="pswp__container">
              <div class="pswp__item"></div>
              <div class="pswp__item"></div>
              <div class="pswp__item"></div>
          </div>
  
          <div class="pswp__ui pswp__ui--hidden">
            
            <div class="pswp__top-bar">
              <div class="pswp__counter"></div>
              <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
              <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
              <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
              <div class="pswp__preloader">
                <div class="pswp__preloader__icn">
                  <div class="pswp__preloader__cut">
                    <div class="pswp__preloader__donut"></div>
                  </div>
                </div>
              </div>
            </div>
  
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
              <div class="pswp__caption__center"></div>
            </div>

          </div>
        
        </div>
      </div>
      <div id="document_panel_id" class="border mt5 bg-light" style="overflow-y: auto;">
      </div>
    </div>
    <div class="col-md-3">
      <div id="comment_panel_id" style="overflow-y: auto;">
        {% include 'backoffice/projects/include/applicant_comments.html' %}
      </div>
    </div>
  </div>
  <form id="dummy_csrf_id" style="display: none;">
    {% csrf_token %}
  </form>
  <script>
    var csrftoken;
    
    var adjustHeight = function(sel, vh) {
      var top = $(sel).offset().top;
      $(sel).css('height',vh - top - 5);
    }

    var resizePanels = function() {
      var vh = $(window).height();
      adjustHeight('#document_panel_id',vh);
      adjustHeight('#document_menu_id',vh);
      adjustHeight('#comment_panel_id',vh);
    };
    
    $(function(){
      resizePanels();
      $(window).resize(resizePanels);

      csrftoken = $("#dummy_csrf_id input[name=csrfmiddlewaretoken]").val();      
    });

   function openPhotoSwipe(href) {
      var pswpElement = document.querySelectorAll('.pswp')[0];
      // build items array
      var items = [
        {
          src: 'http://localhost:8000' + href,
          w: 0,
          h: 0
        },
      ];
        
      // define options (if needed)
      var options = {
        // history & focus options are disabled on CodePen        
        history: false,
        focus: false,

        showAnimationDuration: 0,
        hideAnimationDuration: 0  
      };
    
      var gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
      gallery.listen('gettingData', function(index, item) {
          if (item.w < 1 || item.h < 1) { // unknown size
            var img = new Image();
            img.onload = function() { // will get size after load
            item.w = this.width; // set image width
            item.h = this.height; // set image height
            gallery.invalidateCurrItems(); // reinit Items
            gallery.updateSize(true); // reinit Items
          }
          img.src = item.src; // let's download image
        }
      });

      gallery.init();
    };
  </script>
{% endblock %}
