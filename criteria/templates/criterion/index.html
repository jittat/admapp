{% extends 'backoffice/base.html' %} {% block content %}
<div class="row">
  <div class="col-md-12">
    <h2>แก้ไขเกณฑ์ โครงการ{{ project.title }} ({{ admission_round }})</h2>
    <div class="alert alert-info">
      เลือกสาขาวิชาที่เปิดรับในโครงการ{{ project.title }}
      <a class="btn btn-sm btn-info"
        href="{% url 'backoffice:criteria:curriculum-majors' project.id admission_round.id %}">เลือกสาขาวิชา</a>
    </div>
    {% if notice %}
    <div class="alert alert-success">{{ notice }}</div>
    {% endif %}
    <table class="table table-sm">
      <thead class="thead-dark">
        <tr>
          <th>สาขาวิชาที่ใช้เกณฑ์</th>
          <th>เงื่อนไขขั้นต่ำ</th>
          <th>เกณฑ์การพิจารณา</th>
          <th>แก้ไข</th>
        </tr>
      </thead>
      {% for admission_criteria in admission_criterias %}
      {% with scorecriterias=admission_criteria.scorecriteria_set.all %}
      <tr>
        <td>
          <ul>
            {% for major in admission_criteria.curriculummajor_set.all %}
            <li>{{major.cupt_code}}</li>
            {% endfor %}
          </ul>
        </td>
        <td>
          <ul>
            {% for scorecriteria in scorecriterias %}
            {% if scorecriteria.criteria_type == "required" and scorecriteria.secondary_order == 0  %}
            <li>
              {{scorecriteria.description}} {%if scorecriteria.unit %}ไม่ต่ำกว่า {% endif %}
              {{scorecriteria.value|floatformat:1}} {{scorecriteria.unit}}
            </li>
            {% endif %} {% endfor %}
          </ul>
        </td>
        <td>
          <ul>
            {% for scorecriteria in scorecriterias %}
            {% if scorecriteria.criteria_type == "scoring" and scorecriteria.secondary_order == 0 %}
            <li>{{scorecriteria.description}}</li>
            {% endif %} {% endfor %}
          </ul>
        </td>
        <td>
          <button
            href="{% url 'backoffice:criteria:create' project.id admission_round.id %}?duplicate_score_id={{admission_criteria.id}}"
            class="btn btn-primary btn-sm">คัดลอกเงื่อนไขและเกณฑ์การพิจารณา</button>
          <br>
          <a href="#" class="btn btn-secondary btn-sm">คัดลอกไปยังโครงการอื่น</a>
          <br>
          <a href="{% url 'backoffice:criteria:edit' project.id admission_round.id admission_criteria.id %}"
            class="btn btn-info btn-sm">แก้ไข</a>
          <br>
          <form action="{% url 'backoffice:criteria:delete' project.id admission_round.id admission_criteria.id %}"
            id="delete_{{admission_criteria.id}}" method="post">
            {% csrf_token %}
          </form>
          <button class="btn btn-danger btn-sm" onclick="deleteCriteria('delete_{{admission_criteria.id}}')">ลบ</button>
        </td>
      </tr>
      {% endwith %}
      {% endfor %}
      {% for major in free_curriculum_majors %}
      <tr>
        <td>
          <ul>
            <li>{{major.cupt_code}}</li>
          </ul>
        </td>
        <td>
          (ยังไม่มีการกำหนดเกณฑ์)
        </td>
        <td>
        </td>
        <td>
          <a href="{% url 'backoffice:criteria:create' project.id admission_round.id %}?selected_major_id={{major.id}}"
            class="btn btn-success btn-sm">กำหนดเงื่อนไขและเกณฑ์การพิจารณา</a>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
  <script>
    function deleteCriteria(text) {
      let ok = confirm('ต้องการลบเกณฑ์?')
      if (ok) {
        $('form#' + text).submit()
      }
    }
  </script>
</div>
{% endblock %}